var detailsRefreshInt, chatTabs, tabs, response = !0, linkifySys = !0, activeChat = "", chats = {}, chatUsers = {},
    chatIDs = {}, inviteOpData = {}, detailsRefresh = {}, chatDiv = "", popOverOptions = {
        placement: function (a, e) {
            return $(window).width() < 751 ? "top" : "right"
        }, trigger: "hover"
    };

function widthMe() {
    alert($(document).width())
}

function disabledDept() {
    return swal(oopsTxt, noDepTxt, "info"), !1
}

function loadMobilePage(a, e) {
    $("#onlineDataBox").css("display", "none"), $("#onlineDataOpBox").css("display", "none"), $("#chatDataBox").css("display", "none"), $("#userDetails").css("display", "none"), $("#userPages").css("display", "none"), $("#scroll-nav > .active").removeClass("active"), "chat" === a ? ($("#chatDataBox").css("display", "block"), $(e).parent().addClass("active")) : "users" === a ? ($("#onlineDataBox").css("display", "block"), $(e).parent().addClass("active")) : "details" === a ? ($("#userDetails").css("display", "block"), $("#userPages").css("display", "block"), $(e).parent().addClass("active")) : "operators" === a && ($("#onlineDataOpBox").css("display", "block"), $(e).parent().addClass("active"))
}

function htmlspecialchars(a) {
    var e = {"&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "'"};
    return a.replace(/[&<>"']/g, function (a) {
        return e[a]
    })
}

function escapeRegExp(a) {
    return a.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")
}

function inc() {
    return chats[activeChat].tokenID++
}

function playTone(a) {
    tone && (1 == $("#tone" + a).val() && myTone.play())
}

function muteSound(a) {
    1 == $("#tone" + a).val() ? ($("#tone" + a).val(0), $("#toneK" + a).removeClass("fa-volume-up"), $("#toneK" + a).addClass("fa-volume-off ")) : ($("#tone" + a).val(1), $("#toneK" + a).addClass("fa-volume-up"), $("#toneK" + a).removeClass("fa-volume-off "))
}

function showSmiles(a) {
    hideCannedMsg(a), chats[activeChat = a].smilesWin ? hideSmiles(!1, a) : (chats[activeChat].smilesWin = !0, $("#" + activeChat + " > .chat-page > .chat-smiles").fadeIn())
}

function selSmile(a, e) {
    activeChat = e;
    var t = $("#" + activeChat + " > .chat-page > .chatForm > .input-group > .input-group-area > .chatTxt");
    $(t).val($(t).val() + " " + a + " ");
    var s = $(t).get(0), i = s.value.length;
    s.selectionStart = i, s.selectionEnd = i, s.focus(), hideSmiles(!0, e)
}

function hideSmiles(a, e) {
    activeChat = e;
    var t = $("#" + activeChat + " > .chat-page > .chat-smiles");
    chats[activeChat].smilesWin = !1, void 0 === a && (a = !1), a ? $(t).hide() : $(t).fadeOut()
}

function refreshData() {

    response && (response = !1, $.get(axPath + "/chats/refresh", function (a) {

        if (response = !0, a.success) {
            $("#onlineCount").html("(" + a.onlineUsersCount + ")");
            var e = $("#onlineData > .ulscroll").scrollTop();

            $("#onlineData").html(a.onlineData), $("#onlineData > .ulscroll").scrollTop(e), $("#adminCount").html("(" + a.onlineAdminCount + ")"), $("#adminData").html(a.adminData), $("#inviteData").html(a.inviteData), $('[data-toggle="popover"]').popover(popOverOptions), a.inviteChatBol && Object.keys(a.inviteChat).forEach(function (e) {

                a.inviteChat[e].admin ? genAdminChatWindow(a.inviteChat[e].userID, a.inviteChat[e].userName, a.inviteChat[e].chatID, !0, null, a.inviteChat[e].type, a.inviteChat[e].ownerID) : genChatWindow(a.inviteChat[e].userID, a.inviteChat[e].userName, a.inviteChat[e].chatID, !0, null, a.inviteChat[e].type, a.inviteChat[e].ownerID)
            }), a.updateChatHTML && Object.keys(a.chatHTML).forEach(function (e) {
                $("#userPages" + a.chatHTML[e].chatID + " .pagesBody").html(a.chatHTML[e].pagesData);
                var t = a.chatHTML[e].chatHTML;

                $.extend(users, a.chatHTML[e].users);
                for (var s = 0; s < t.length; ++s) "1" === t[s].notify ? notifyMsg(t[s].msg, !1, e) : (t[s].upload && (linkifySys = !1), addMsg(t[s].msg, t[s].user_id, t[s].staff_id, !1, t[s].date, e, !1), playTone(a.chatHTML[e].chatID));
                0 === a.chatHTML[e].chatStatus && ($("#chat" + a.chatHTML[e].chatID + " .chat-page").append('<input type="hidden" class="closed" value="1" />'), $("#chat" + a.chatHTML[e].chatID + " .chatTxt").prop("disabled", !0), $("#chat" + a.chatHTML[e].chatID + " .input-group-right").addClass("inDisabled"), $("#chat" + a.chatHTML[e].chatID + " .chatTxtIcon").prop("onclick", null).off("click"), $("#chat" + a.chatHTML[e].chatID + " .send-file-btn").removeClass("send-file-btn"))
            })
        } else swal(oopsTxt, errSomTxt, "info")
    }))

    /*var porka=  document.getElementsByClassName('nav-pills');

    var madonca=  porka[0].getElementsByTagName('li');
    madonca[0].setAttribute("class","jebisimater");*/
 /*   if(koncno.indexOf("Guest")!==-1){
        alert(madonca[0].innerText)
        madonca[0].getElementsByTagName('li').style.visibility="hidden";
    }*/
    /*for(var x=0;x>porka.length()-1;x++){
   alert(porka[x].getAttribute('onclick'));
}*/

}

function notifyMsg(a, e, t) {
    var s;
    void 0 === e && (e = !0), activeChat = t, chatDiv = $("#" + activeChat + " > .chat-page > .chat-history");
    var i = $('<div class="notify">' + a + "....</div>").hide();
    $(chatDiv).append(i), i.fadeIn(), $(chatDiv).animate({scrollTop: $(chatDiv)[0].scrollHeight}, "fast"), chats[activeChat].lastMsg = {}, e && (s = {
        json: "1",
        msg: a,
        chatID: chatID
    }, $.post(axPath + "/add-notify-msg", s, function (a) {
    }))
}

function generateMsg(a, e, t) {
    var s = {};
    return a.msg = emoticons(t ? htmlspecialchars(a.msg).linkify() : a.msg.linkify(), emoticonsData), s = void 0 !== users[a.user] ? users[a.user] : {
        name: unknownTxt,
        avatarLink: defaultAvatar
    }, void 0 === e && (e = !1), (!0 === e ? subTemplate : template).replace(/{{messageId}}/g, "msg_" + a.id).replace(/{{contentId}}/g, "con_" + a.id).replace(/{{nowTime}}/g, a.nowTime).replace(/{{message}}/g, a.msg).replace(/{{msgAdd}}/g, "").replace(/{{userName}}/g, s.name).replace(/{{avatarLink}}/g, s.avatarLink)
}

function emoticons(a, e) {
    var t;
    return t = e, Object.keys(t).reduce(function (a, e) {
        var s = new RegExp(escapeRegExp(e), "g"), i = String(t[e][1]).replace(/\$/g, "$$$$");
        return a.replace(s, i)
    }, a)
}

function addLastMsg(a, e, t) {
    chats[activeChat].lastMsg = {id: a, msgid: "msg_" + a, conid: "con_" + a, user: e, time: t}
}

function addMsg(a, e, t, s, i, n, o) {
    var c, l, r, d, h, u;
    (activeChat = n, nowTime = new Date, void 0 === s && (s = !0), void 0 === o && (o = !0), void 0 === i && (i = nowTime), chatDiv = $("#" + activeChat + " > .chat-page > .chat-history"), -1 === e ? (u = t, h = "staff" + t) : (u = e, h = "user" + e), void 0 === chats[activeChat].lastMsg.user ? newIndex = 0 : chats[activeChat].lastMsg.user !== h ? newIndex = 0 : newIndex = 1, 0 === newIndex) ? (newIndex = 1, r = chats[activeChat].chatID + "_" + inc(), d = {
        json: "1",
        msg: a,
        chatID: chats[activeChat].chatID
    }, addLastMsg(r, h, i), c = generateMsg({
        id: r,
        nowTime: i,
        msg: a,
        userId: u,
        user: h
    }, !1, o), l = chatDiv) : (d = {
        json: "1",
        msg: a,
        chatID: chats[activeChat].chatID,
        subMsg: !0
    }, Date.parse(i) - Date.parse(chats[activeChat].lastMsg.time) > 6e4 ? (r = chats[activeChat].chatID + "_" + inc(), l = document.getElementById(chats[activeChat].lastMsg.conid), addLastMsg(r, h, i), c = generateMsg({
        id: r,
        nowTime: i,
        msg: a,
        userId: u,
        user: h
    }, !0, o)) : (chats[activeChat].lastMsg.time = i, c = o ? "<div>" + emoticons(htmlspecialchars(a).linkify(), emoticonsData) + "</div>" : "<div>" + emoticons(a.linkify(), emoticonsData) + "</div>", l = document.getElementById(chats[activeChat].lastMsg.msgid)));
    var p = $(c).hide();
    $(l).append(p), p.fadeIn(), $(chatDiv).animate({scrollTop: $(chatDiv)[0].scrollHeight}, "fast"), timeago.cancel(), timeago().render($(".caltime")), $(".tab-content").find("div.active").attr("id").substr(3) != chats[activeChat].chatID && flashIt(chats[activeChat].chatID, 1), s && $.post(axPath + "/add", d, function (a) {
    })
}

function addChatHTML(a) {
    a.success && (void 0 !== a.pagesData && ($("#userPages" + a.chatID).html(a.pagesData), $("#userPages" + a.chatID + " .userLoad").hide(), $("#userPages" + a.chatID + " #tableData").removeClass("hide")), $(chatDiv).append(a.chatHTML), chats[activeChat].lastMsg = a.lastMsg, $.extend(users, a.users), chats[activeChat].tokenID = a.token, timeago.cancel(), timeago().render($(".caltime")), $(chatDiv).animate({scrollTop: $(chatDiv)[0].scrollHeight}, "fast"))
}

function waitGuestChat(a, e, t, s, i, n) {
    swal(oopsTxt, alreadyCTxt, "info")
}

function selInviteStaff(a) {
    var e = activeChat.substr(4);
    inviteOpData = {staffID: a, chatID: e}
}

function inviteUser() {
    var a = document.createElement("div");
    a.innerHTML = "<style>.swal-modal {width: 280px}.swal-content{text-align:left}.swal-button--confirm{background-color: #98D973}.swal-button--confirm:focus{box-shadow: 0 0 0 1px #fff, 0 0 0 3px rgba(152, 217, 115, 0.29)}</style>", a.innerHTML += $("#inviteData").html(), swal({
        title: inOpTxt,
        content: a,
        buttons: ["Cancel", "Invite"]
    }).then(a => {
        a ? void 0 !== inviteOpData.chatID ? $.post(axPath + "/inviteStaff", inviteOpData, function (a) {
            a.success ? swal("Success!", inTxt, "success") : void 0 === a.error ? swal(oopsTxt, intTxt, "error") : swal(oopsTxt, a.error, "error"), inviteOpData = {}
        }) : swal(oopsTxt, selOpTxt, "error") : inviteOpData = {}
    })
}

function guestChatWindow(a, e, t, s, i, n, o) {
    swal({title: inUsTxt, text: areInUsTxt, buttons: [cancelTxt, inviteTxt], dangerMode: !0}).then(e => {
        e && $.get(axPath + "/invite/" + a + "/" + i, function (a) {

            a.success ? genChatWindow(a.userID, a.userName, a.chatID, !0, void 0, void 0, a.ownerID) : swal(oopsTxt, unStartTxt, "error")

        })
    })

}



function joinChatWindow(a, e, t, s, i, n, o) {
    swal({title: joinTxt, text: useChatTxt, buttons: [cancelTxt, joinTxt1], dangerMode: !0}).then(n => {
        n && genChatWindow(a, e, t, s, i, 4, o)
    })
}

function processUserDetails() {
    $.post(axPath + "/userDetailsArr", {chats: detailsRefresh}, function (a) {

        a.success && (a.remove && clearInterval(detailsRefreshInt), Object.keys(a.userDetails).forEach(function (e) {
            var t = a.userDetails[e], s = $("#masterUserDetails").html();
            s = (s = (s = (s = (s = (s = (s = (s = (s = (s = s.replace(/{{ip}}/g, t.ip)).replace(/{{username}}/g, t.name)).replace(/{{email}}/g, t.email)).replace(/{{location}}/g, t.location)).replace(/{{browser}}/g, t.browser)).replace(/{{platform}}/g, t.platform)).replace(/{{ua}}/g, t.ua)).replace(/{{screen}}/g, t.screen)).replace(/{{tabID}}/g, "tab" + e)).replace(/{{chatID}}/g, e), $("#userDetails" + e).html(s), $("#userDetails" + e + " .userLoad").hide(), $("#userDetails" + e + " .table").fadeIn(), $("#userDetails" + e + " .btnDis").prop("disabled", !1), $("#userDetails" + e + " .table").removeClass("hide"), delete detailsRefresh["chat" + e]
        }))
    })
}

function adminChatWindow(a, e, t, s, i, n, o) {
    a != adminID ? 0 == t ? $.get(axPath + "/createAdminChat/" + a, function (i) {
        i.success && (t = i.chatID, genAdminChatWindow(a, e, t, s, i, n, o))
    }) : genAdminChatWindow(a, e, t, s, i, n, o) : sweetAlert(oopsTxt, cantTxt, "error")
}

function cannedBox(a) {
    1 == $("#canned" + a).val() ? ($("#canned" + a).val(0), $("#cannedK" + a).removeClass("glyphicon-ok-sign"), $("#cannedK" + a).addClass("glyphicon-remove-sign")) : ($("#canned" + a).val(1), $("#cannedK" + a).addClass("glyphicon-ok-sign"), $("#cannedK" + a).removeClass("fa-remove-off "))
}

function hideCannedMsg(a) {
    var e = $("#" + a + " #cannedMsg");
    $(e).fadeOut()
}

function setCannedMsg(a, e) {
    var t = $(e).find(".wordData" + a).html(), s = $(e).find(".word" + a).data("temp"),
        i = $(e).find(".word" + a).data("chat"), n = $("#chat" + i + " .chatTxt").val(),
        o = $("#chat" + i + " #cannedMsg");
    n = n.replace(new RegExp(s + "$"), t), $("#chat" + i + " .chatTxt").val(n), $("#chat" + i + " .chatTxt").focus(), $(o).fadeOut()
}

function processCannedMsg(a, e, t, s, i, n) {
    var o = 1;
    0 == t && $(a).fadeOut(), Object.keys(s).forEach(function (t) {
        var c, l, r, d, h;
        1 === cannedMsgType ? (l = t, c = s[t]) : (l = s[t].code, c = s[t].data), $(a).fadeIn(), $("#chat" + e + " .wordData" + o).html(c), l.match(i) && (h = new RegExp(i, "gi"), d = l.replace(h, "<strong>" + i + "</strong>"), r = i), "" != n && l.match(n + " " + i) && (h = new RegExp(n + " " + i, "gi"), d = l.replace(h, "<strong>" + n + " " + i + "</strong>"), r = n + " " + i), $("#chat" + e + " .word" + o).data("temp", r), $("#chat" + e + " .word" + o).data("chat", e), $("#chat" + e + " .word" + o).html(d), o++
    })
}

function cannedMsg(a, e) {
    var t = $("#chat" + e + " #cannedMsg"), s = a.split(" "), i = s[s.length - 1], n = s[s.length - 2], o = !0;
    if ("" != i && i.length > 2) if (o = !1, void 0 === n && (n = ""), $("#chat" + e + " .word1").html(""), $("#chat" + e + " .word2").html(""), $("#chat" + e + " .word3").html(""), $("#chat" + e + " .wordData1").html(""), $("#chat" + e + " .wordData2").html(""), $("#chat" + e + " .wordData3").html(""), 1 === cannedMsgType) $.post(axPath + "/search-canned", {
        word: i,
        word2: n,
        chat_id: e
    }, function (a) {
        a.success && processCannedMsg(t, e, a.count, a.canned, i, n, cannedMsgType)
    }); else {
        var c = new RegExp("^" + i, "i"), l = $.grep(cannedMsgArr, function (a, e) {
            return c.test(a.code)
        });
        if (l.length < 3) {
            c = new RegExp("^" + n + " " + i, "i");
            var r = $.grep(cannedMsgArr, function (a, e) {
                return c.test(a.code)
            })
        }
        var d = l.concat(r);
        processCannedMsg(t, e, d.length, d, i, n, cannedMsgType)
    }
    o && $(t).fadeOut()
}

function genAdminChatWindow(a, e, t, s, i, n, o) {
    o = adminID;
    var c = "staff" + a, l = "chat" + t;
    if (flashIt(t, 0), void 0 === chatIDs[t]) {
        var r = $("#masterAdminDetails").html();
        $("#userDetails").find("div.nohide").removeClass("nohide").addClass("hide"), $("#userDetails").append('<div id="userDetails' + t + '" class="nohide">' + r + "</div>"), chatIDs[t] = "";
        var d = $("#masterChatdata").html();
        d = (d = d.replace(/{{userID}}/g, l)).replace(/{{ownerID}}/g, o), tabs = $("#tabs").bootstrapDynamicTabs(), activeChat = l, chats[l] = {
            smilesWin: !1,
            lastMsg: {},
            tokenID: 0,
            chatID: t,
            disabledBox: []
        }, tabs.addTab({
            id: "tab" + t,
            title: '<span id="title' + t + '"><i class="fa fa-star" aria-hidden="true"></i>  ' + e + "</span>",
            html: d
        }), chatDiv = $("#" + activeChat + " > .chat-page > .chat-history");
        var h = $("#" + activeChat + " > .chat-page > .chatForm > .input-group > .input-group-area > .chatTxt"),
            u = $("#" + activeChat + " > .chat-page > .chatForm");
        if (s) {
            var p = axPath + "/load-messages-html/" + t + "/" + c;
            void 0 !== n && (p = p + "/" + n), $.get(p, function (a) {
                addChatHTML(a)
            })
        } else addChatHTML(i);
        $.get(axPath + "/adminDetails/" + t + "/" + a, function (a) {
            a.success && (r = (r = (r = (r = (r = (r = (r = (r = (r = (r = (r = (r = r.replace(/{{ip}}/g, a.ip)).replace(/{{username}}/g, a.name)).replace(/{{email}}/g, a.email)).replace(/{{location}}/g, a.location)).replace(/{{browser}}/g, a.browser)).replace(/{{platform}}/g, a.platform)).replace(/{{ua}}/g, a.ua)).replace(/{{role}}/g, a.role)).replace(/{{access}}/g, a.access)).replace(/{{logo}}/g, a.logo)).replace(/{{chatID}}/g, a.chatID)).replace(/{{tabID}}/g, "tab" + t), $("#userDetails" + t).html(r), $("#userDetails" + t + " .userLoad").hide(), $("#userDetails" + t + " .myprofile").fadeIn(), $("#userDetails" + t + " .table").fadeIn(), $("#userDetails" + t + " .btnDis").prop("disabled", !1), $("#userDetails" + t + " .table").removeClass("hide"), $("#userDetails" + t + " .myprofile").removeClass("hide"))
        }), $(u).submit(function (a) {
            a.preventDefault();
            var e = $(h).val().trim();
            "" !== e && ($(h).val(""), addMsg(e, -1, adminID, !0, void 0, activeChat))
        }), $(h).on("keyup", function (a) {
            cannedMsgBol && (1 == $("#canned" + t).val() && cannedMsg(h.val(), t))
        }), $(chatDiv).click(function (a) {
            hideSmiles(!1, activeChat)
        }), $(h).click(function (a) {
            hideSmiles(!1, activeChat)
        }), $(h).focus(function () {
            $(".input-group").addClass("focused")
        }).blur(function () {
            $(".input-group").removeClass("focused")
        }), scrollTab()
    } else {
        activeChat = l, $("#userDetails").find("div.nohide").removeClass("nohide").addClass("hide"), $("#userDetails" + t).removeClass("hide").addClass("nohide"), $("#tabs > .nav-tabs").find("li.active").removeClass("active"), $("#tabs > .nav-tabs").find("li").find('a[href="#tab' + t + '"]').tab("show"), scrollTab()
    }
    $("#chat" + t + " .chat-page").append('<input type="hidden" class="chatAdminID" value="' + a + '" />')
}

function genChatWindow(a, e, t, s, i, n, o) {
    var c = "user" + a, l = "chat" + t;
    if (flashIt(t, 0), -1 === (o = parseInt(o)) && (o = adminID), void 0 === chatIDs[t]) {
        var r = $("#masterUserDetails").html(), d = $("#masterUserPages").html();
        $("#userDetails").find("div.nohide").removeClass("nohide").addClass("hide"), $("#userDetails").append('<div id="userDetails' + t + '" class="nohide">' + r + "</div>"), $("#userPages").find("div.nohide").removeClass("nohide").addClass("hide"), $("#userPages").append('<div id="userPages' + t + '" class="nohide">' + d + "</div>"), chatIDs[t] = "";
        var h = $("#masterChatdata").html();
        h = (h = h.replace(/{{userID}}/g, l)).replace(/{{ownerID}}/g, o), tabs = $("#tabs").bootstrapDynamicTabs(), activeChat = l, chats[l] = {
            smilesWin: !1,
            lastMsg: {},
            tokenID: 0,
            chatID: t,
            disabledBox: []
        }, tabs.addTab({
            id: "tab" + t,
            title: '<span id="title' + t + '">' + e + "</span>",
            html: h
        }), chatDiv = $("#" + activeChat + " > .chat-page > .chat-history");
        var u = $("#" + activeChat + " > .chat-page > .chatForm > .input-group > .input-group-area > .chatTxt"),
            p = $("#" + activeChat + " > .chat-page > .chatForm");
        if (s) {
            var v = axPath + "/load-messages-html/" + t + "/" + c;
            void 0 !== n && (v = v + "/" + n), $.get(v, function (a) {
                addChatHTML(a)
            })
        } else i.pagesData = d.replace(/{{tableData}}/g, i.pagesData), addChatHTML(i);
        $.get(axPath + "/userDetails/" + t, function (a) {
            a.success ? (r = (r = (r = (r = (r = (r = (r = (r = (r = (r = r.replace(/{{ip}}/g, a.ip)).replace(/{{username}}/g, a.name)).replace(/{{email}}/g, a.email)).replace(/{{location}}/g, a.location)).replace(/{{browser}}/g, a.browser)).replace(/{{platform}}/g, a.platform)).replace(/{{ua}}/g, a.ua)).replace(/{{screen}}/g, a.screen)).replace(/{{tabID}}/g, "tab" + t)).replace(/{{chatID}}/g, t), $("#userDetails" + t).html(r), $("#userDetails" + t + " .userLoad").hide(), $("#userDetails" + t + " .table").fadeIn(), $("#userDetails" + t + " .btnDis").prop("disabled", !1), $("#userDetails" + t + " .table").removeClass("hide")) : (0 === Object.keys(detailsRefresh).length && (detailsRefreshInt = setInterval(processUserDetails, chatRefreshTime)), detailsRefresh[l] = t)
        }), $(p).submit(function (a) {
            a.preventDefault();
            var e = $(u).val().trim();
            "" !== e && ($(u).val(""), addMsg(e, -1, adminID, !0, void 0, activeChat))
        }), $(u).on("keyup", function (a) {
            cannedMsgBol && (1 == $("#canned" + t).val() && cannedMsg(u.val(), t))
        }), $(chatDiv).click(function (a) {
            hideSmiles(!1, activeChat)
        }), $(u).click(function (a) {
            hideSmiles(!1, activeChat)
        }), $(u).focus(function () {
            $(".input-group").addClass("focused")
        }).blur(function () {
            $(".input-group").removeClass("focused")
        }), scrollTab()
    } else {
        activeChat = l, $("#userDetails").find("div.nohide").removeClass("nohide").addClass("hide"), $("#userDetails" + t).removeClass("hide").addClass("nohide"), $("#userPages").find("div.nohide").removeClass("nohide").addClass("hide"), $("#userPages" + t).removeClass("hide").addClass("nohide"), $("#tabs > .nav-tabs").find("li.active").removeClass("active"), $("#tabs > .nav-tabs").find("li").find('a[href="#tab' + t + '"]').tab("show"), scrollTab()
    }
}

function scrollTab() {
    try {
        $("#tabs > .nav-tabs").find("li.tab_selected").removeClass("tab_selected"), $("#tabs > .nav-tabs").find("li.active").addClass("tab_selected");
        var a = $(".scroll_tab_inner").scrollLeft(), e = $("#tabs > .nav-tabs").find("li.active").position().left;
        $(".scroll_tab_inner").scrollLeft(a + e)
    } catch (a) {
    }
}

function activateTab(a, e) {
    return void 0 !== e && e.preventDefault(), flashIt(a = a.substr(3), 0), activeChat = "chat" + a, $("#userDetails").find("div.nohide").removeClass("nohide").addClass("hide"), $("#userDetails" + a).removeClass("hide").addClass("nohide"), $("#userPages").find("div.nohide").removeClass("nohide").addClass("hide"), $("#userPages" + a).removeClass("hide").addClass("nohide"), $("#tabs > .nav-tabs").find("li.active").removeClass("active"), $("#tabs > .nav-tabs").find("li").find('a[href="#tab' + a + '"]').tab("show"), !1
}

function flashIt(a, e) {
    0 === e ? $("#title" + a).removeClass("flashit") : $("#title" + a).addClass("flashit")
}

function closeTab(a, e) {
    var t = a.substr(3), s = $("#chat" + t + " .ownerID").val(), i = 1, n = 0;
    $("#chat" + t + " .closed").length && (i = 0), $("#chat" + t + " .chatAdminID").length && (n = $("#chat" + t + " .chatAdminID").val()), void 0 !== e && (e.preventDefault(), e.stopPropagation()), 0 === i ? s == adminID ? closeCall(t, a, i, n) : leaveCall(t, a, i) : s == adminID ? swal({
        title: sureTxt,
        text: sureTxt1,
        icon: "warning",
        buttons: !0,
        dangerMode: !0
    }).then(e => {
        e && closeCall(t, a, i, n)
    }) : swal({title: leaveTxt, text: leaveTxt1, icon: "warning", buttons: !0, dangerMode: !0}).then(e => {
        e && leaveCall(t, a, i)
    })
}

function closeCall(a, e, t, s) {
    $.get(axPath + "/close/" + a + "/" + t + "/" + s, function (t) {
        t.success ? (tabs.closeById(e), delete chatIDs[a], $("#userDetails" + a).removeClass("nohide").addClass("hide").remove(), $("#userPages" + a).removeClass("nohide").addClass("hide").remove()) : swal(oopsTxt, failTxt, "error")
    })
}

function leaveCall(a, e, t) {
    $.get(axPath + "/leave/" + a + "/" + t, function (t) {
        t.success ? (tabs.closeById(e), delete chatIDs[a], $("#userDetails" + a).removeClass("nohide").addClass("hide").remove(), $("#userPages" + a).removeClass("nohide").addClass("hide").remove()) : swal(oopsTxt, failTxt, "error")
    })
}

function formatBytes(a, e) {
    if (0 == a) return "0 Bytes";
    var t = e <= 0 ? 0 : e || 2, s = Math.floor(Math.log(a) / Math.log(1024));
    return parseFloat((a / Math.pow(1024, s)).toFixed(t)) + " " + ["Bytes", "KB", "MB", "GB", "TB", "PB", "EB", "ZB", "YB"][s]
}

function refreshAdminAnalytics() {
    $.get(axPath + "/ping", function (a) {
    })
}

function genUploadBox(a, e, t, s, i) {
    var n = "";
    return "audio" === s ? n = "uploadAudio" : "video" === s ? n = "uploadVideo" : "image" === s ? n = "uploadImg" : "zip" === s && (n = "uploadZip"), t = formatBytes(t), '<div class="uploadBox ' + n + '" id="upload' + a + '">\n    <div class="upInfo">' + fileTxt + " " + e + '</div>\n    <div class="upInfo">' + sizeTxt + " " + t + '</div>\n    <hr>\n    <div class="uploadBoxRes" id="uploadRes' + a + '">\n      <span class="uploading"><span class="icon-upload2"></span> ' + i + ' <img class="loader" src="' + previewImgLoader + '" /></span>\n    </div>\n    </div>'
}

String.linkify || (String.prototype.linkify = function () {
    if (!linkifySys) return linkifySys = !0, this;
    return this.replace(/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim, function (a) {
        switch (a.substr(a.lastIndexOf(".") + 1)) {
            case"jpg":
            case"png":
            case"jpeg":
            case"gif":
            case"bmp":
                var e = "pre" + (new Date).getTime().toString() + Math.floor(1e3 * Math.random() + 1).toString(),
                    t = $("<img />").attr("src", a).on("load error", function (a) {
                        "error" === a.type ? (t.attr("alt", errLoadTxt), $("#" + e).html('<i style="color: #e74c3c;" class="fa fa-exclamation-triangle"></i>')) : this.complete && void 0 !== this.naturalWidth && 0 != this.naturalWidth ? (t.attr("class", "previewImg"), t.attr("alt", previewTxt), $("#" + e).html(t)) : (t.attr("alt", errLoadTxt), $("#" + e).html('<i style="color: #e74c3c;" class="fa fa-exclamation-triangle"></i>'))
                    });
                return '<a target="_blank" href="' + a + '"><div> <div id="' + e + '" class="previewBox"><img class="previewImg" src="' + previewImgLoader + '" alt="' + loadingTxt + '"></div> </div> ' + a + "</a> ";
            default:
                return '<a target="_blank" href="' + a + '">' + a + "</a>"
        }
    }).replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim, '$1<a target="_blank" href="http://$2">$2</a>').replace(/[\w.]+@[a-zA-Z_-]+?(?:\.[a-zA-Z]{2,6})+/gim, '<a target="_blank" href="mailto:$&">$&</a>')
});
var Upload = function (a) {
    this.file = a
};
Upload.prototype.getType = function () {
    return this.file.type
}, Upload.prototype.getSize = function () {
    return this.file.size
}, Upload.prototype.getName = function () {
    return this.file.name
}, Upload.prototype.doUpload = function (a, e) {
    var t = this, s = new FormData;
    s.append("file", this.file, this.getName()), s.append("upload_file", !0), $.ajax({
        type: "POST",
        url: axPath + "/upload/process/" + a + "/" + e,
        xhr: function () {
            var a = $.ajaxSettings.xhr();
            return a.upload && a.upload.addEventListener("progress", t.progressHandling, !1), a
        },
        success: function (e) {
            e.success && (e.upload ? $("#uploadRes" + a).html('<a class="uploadBoxHref" target="_blank" href="' + axPath + "/upload/view/" + a + '"><span class="icon-download2"></span> ' + downloadTxt + "</a>") : $("#uploadRes" + a).html('<span class="upFail"> <span class="icon-cross"></span> ' + e.error + "</span>"))
        },
        error: function (e) {
            $("#uploadRes" + a).html('<span class="upFail"> <span class="icon-cross"></span> ' + upFailTxt + "</span>")
        },
        async: !0,
        data: s,
        cache: !1,
        contentType: !1,
        processData: !1,
        timeout: 6e4
    })
}, Upload.prototype.progressHandling = function (a) {
    var e = 0, t = a.loaded || a.position, s = a.total;
    a.lengthComputable && (e = Math.ceil(t / s * 100)), $("#progress-wrp .progress-bar").css("width", +e + "%"), $("#progress-wrp .status").text(e + "%")
}, $(document).ready(function () {
    ($.ajaxSetup({
        timeout: 2e4, error: function (a) {
            "timeout" === a.statusText ? console.log("Connection Timeout: Please check your internet connection and try again!") : "error" === a.statusText && console.log("Network Error!")
        }
    }), setInterval(refreshAdminAnalytics, refreshAnalyticsTime), timeago.register("en", locale), timeago().render($(".caltime")), chatTabs = $("#chatTabs").scrollTabs(), tabs = $("#tabs").bootstrapDynamicTabs(), tone) && (document.getElementById("myTone").src = tonePath);
    $(".tab-content").on("click", ".send-file-btn", function () {
        $(".tab-content #" + activeChat + " .send-file").click()
    }), $(".tab-content").on("change", ".send-file", function (a) {
        var e = $(this)[0].files[0], t = new Upload(e), s = !1, i = activeChat.substr(4);
        chats[activeChat].lastMsg.user === "staff" + adminID && (s = !0), $.post(axPath + "/upload/new", {
            name: t.getName(),
            size: t.getSize(),
            subMsg: s,
            chat_id: i
        }, function (a) {
            a.success ? (linkifySys = !1, a.upload && (addMsg(genUploadBox(a.uploadID, t.getName(), t.getSize(), a.type, "Uploading..."), -1, adminID, !1, void 0, activeChat, !1), t.doUpload(a.uploadID, a.uploadAuth, e))) : alert(a.error)
        })
    }), $.get(axPath + "/chats/load-all", function (a) {
        a.success ? (a.updateChatHTML && Object.keys(a.chatHTML).forEach(function (e) {
            var t = a.chatHTML[e].aUser;
            "staff" === t.substr(0, 5) ? genAdminChatWindow(a.userList[t].id, a.userList[t].name, a.chatHTML[e].chatID, !1, a.chatHTML[e], void 0, a.chatHTML[e].ownerID) : genChatWindow(a.userList[t].id, a.userList[t].name, a.chatHTML[e].chatID, !1, a.chatHTML[e], void 0, a.chatHTML[e].ownerID), 0 === a.chatHTML[e].chatStatus && ($("#chat" + a.chatHTML[e].chatID + " .chat-page").append('<input type="hidden" class="closed" value="1" />'), $("#chat" + a.chatHTML[e].chatID + " .chatTxt").prop("disabled", !0), $("#chat" + a.chatHTML[e].chatID + " .input-group-right").addClass("inDisabled"), $("#chat" + a.chatHTML[e].chatID + " .chatTxtIcon").prop("onclick", null).off("click"), $("#chat" + a.chatHTML[e].chatID + " .send-file-btn").removeClass("send-file-btn"))
        }), a.inviteChatBol && Object.keys(a.inviteChat).forEach(function (e) {
            a.inviteChat[e].admin ? genAdminChatWindow(a.inviteChat[e].userID, a.inviteChat[e].userName, a.inviteChat[e].chatID, !0, null, a.inviteChat[e].type, a.inviteChat[e].ownerID) : genChatWindow(a.inviteChat[e].userID, a.inviteChat[e].userName, a.inviteChat[e].chatID, !0, null, a.inviteChat[e].type, a.inviteChat[e].ownerID)
        }), setInterval(refreshData, chatRefreshTime), $("#onlineCount").html("(" + a.onlineUsersCount + ")"), $("#onlineData").html(a.onlineData), $("#adminCount").html("(" + a.onlineAdminCount + ")"), $("#adminData").html(a.adminData), $("#inviteData").html(a.inviteData), $('[data-toggle="popover"]').popover(popOverOptions)) : swal(oopsTxt, errSomTxt, "info")
    })
});
